<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø© | Ø¬Ø§Ù…Ø¹Ø© ØµØ­Ø§Ø±</title>
    <style>
        :root { --primary: #1e3a8a; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', Tahoma; margin: 0; background: var(--bg); color: #334155; }
        header { background: white; padding: 20px; text-align: center; border-bottom: 1px solid #e2e8f0; }
        .container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
        .hall-card { background: white; border-radius: 24px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .hall-img { height: 400px; width: 100%; object-fit: cover; background: #ddd; }
        .content { padding: 40px; }
        .rating-avg { color: #f59e0b; font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 8px; background: #eff6ff; color: #1e40af; margin: 4px; font-weight: 600; }
        .btn-book { display: inline-block; background: var(--primary); color: white; padding: 15px 30px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 20px; }

        /* Feedback Section Styles */
        .feedback-section { margin-top: 40px; }
        .review-item { background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .review-stars { color: #f59e0b; margin-bottom: 5px; }
    </style>
</head>
<body>

<header><h1>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø©</h1></header>

<div class="container">
    <div class="hall-card">
        <img id="hImg" class="hall-img" src="">
        <div class="content">
            <div id="hRating" class="rating-avg">â­ 0.0</div>
            <h2 id="hName" style="font-size: 32px; margin: 0 0 15px 0;">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©</h2>
            <p id="hDesc" style="line-height: 1.8; color: #64748b;">ÙˆØµÙ Ø§Ù„Ù‚Ø§Ø¹Ø© ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</p>
            <div id="hTags"></div>
            <a id="bookLink" class="btn-book" href="#">Ø§Ø­Ø¬Ø² Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø¢Ù†</a>
        </div>
    </div>

    <div class="feedback-section">
        <h3>Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ğŸ’¬</h3>
        <div id="reviewsList">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCqjKlVjtp7gaEJpQXxVgr1i2xCZUJ7yro", authDomain: "sohar-hall-booking.firebaseapp.com", projectId: "sohar-hall-booking", storageBucket: "sohar-hall-booking.firebasestorage.app", messagingSenderId: "152839243234", appId: "1:152839243234:web:3adddd0567f6631285a5bb" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const hallId = Number(new URLSearchParams(location.search).get("id"));

    async function loadData() {
      // 1. Load Hall Info
      const q = query(collection(db, "halls"), where("id", "==", hallId));
      const snap = await getDocs(q);
      if(!snap.empty) {
        const h = snap.docs[0].data();
        document.getElementById("hName").textContent = h.name;
        document.getElementById("hDesc").textContent = h.desc;
        document.getElementById("hImg").src = h.imageUrl || 'https://via.placeholder.com/800x400';
        document.getElementById("hTags").innerHTML = (h.facilities || []).map(f => `<span class="badge">${f}</span>`).join('');
        document.getElementById("bookLink").href = `ccccc.html?id=${hallId}`;
      }

      // 2. Load Reviews
      const rq = query(collection(db, "reviews"), where("hallId", "==", hallId));
      const rSnap = await getDocs(rq);
      const list = document.getElementById("reviewsList");
      list.innerHTML = "";

      let totalStars = 0;
      rSnap.forEach(doc => {
        const r = doc.data();
        totalStars += r.rating;
        list.innerHTML += `
          <div class="review-item">
            <div class="review-stars">${"â­".repeat(r.rating)}</div>
            <p style="margin: 5px 0; font-weight: bold;">${r.userName}</p>
            <p style="margin: 0; font-size: 14px; color: #64748b;">${r.comment}</p>
          </div>`;
      });

      if(rSnap.size > 0) {
        document.getElementById("hRating").textContent = `â­ ${(totalStars / rSnap.size).toFixed(1)}`;
      }
    }
    loadData();
</script>
</body>
</html>