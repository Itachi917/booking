<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ø¬Ø§Ù…Ø¹Ø© ØµØ­Ø§Ø±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --nav-bg: #1e293b; --accent: #3b82f6; }
        body { font-family: 'Segoe UI', Tahoma; margin: 0; background: #f1f5f9; display: flex; min-height: 100vh; }

        .sidebar { width: 260px; background: var(--nav-bg); color: white; padding: 30px 20px; display: flex; flex-direction: column; }
        .sidebar h2 { font-size: 20px; border-bottom: 1px solid #334155; padding-bottom: 15px; margin-bottom: 25px; }
        .nav-item { padding: 12px 15px; border-radius: 10px; cursor: pointer; transition: 0.3s; margin-bottom: 8px; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: #334155; }
        .nav-item.active { background: var(--accent); }

        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); text-align: center; }
        .stat-card h3 { font-size: 32px; margin: 0; color: var(--nav-bg); }
        .stat-card p { margin: 5px 0 0; color: #64748b; font-weight: 600; }

        .chart-container { background: white; padding: 25px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }

        table { width: 100%; background: white; border-radius: 20px; border-collapse: collapse; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        th { background: #f8fafc; padding: 18px; text-align: center; color: #475569; font-size: 14px; }
        td { padding: 18px; text-align: center; border-top: 1px solid #f1f5f9; }

        .status-pill { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 800; }
        .pending { background: #fef3c7; color: #92400e; }
        .accepted { background: #dcfce7; color: #166534; }

        .btn-action { border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px; transition: 0.2s; }
        .btn-acc { background: #22c55e; color: white; }
        .btn-ref { background: #ef4444; color: white; margin-right: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
    <div class="nav-item active">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
    <div class="nav-item" onclick="location.href='admin-halls.html'">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</div>
    <div class="nav-item" onclick="location.href='ccc.html'">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</div>
</div>

<div class="main">
    <div class="stats-row">
        <div class="stat-card"><h3 id="totalReq">0</h3><p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p></div>
        <div class="stat-card"><h3 id="pendingReq" style="color: #f59e0b;">0</h3><p>Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p></div>
        <div class="stat-card"><h3 id="acceptedReq" style="color: #10b981;">0</h3><p>Ø·Ù„Ø¨Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©</p></div>
    </div>

    <div class="chart-container">
        <canvas id="usageChart" height="100"></canvas>
    </div>

    <table>
        <thead><tr><th>Ø§Ù„Ù‚Ø§Ø¹Ø©</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody id="rows"></tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyCqjKlVjtp7gaEJpQXxVgr1i2xCZUJ7yro", authDomain: "sohar-hall-booking.firebaseapp.com", projectId: "sohar-hall-booking", storageBucket: "sohar-hall-booking.firebasestorage.app", messagingSenderId: "152839243234", appId: "1:152839243234:web:3adddd0567f6631285a5bb" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function load() {
      const snap = await getDocs(query(collection(db, "bookings"), orderBy("timestamp", "desc")));
      const bookings = snap.docs.map(d => ({id: d.id, ...d.data()}));

      document.getElementById("totalReq").innerText = bookings.length;
      document.getElementById("pendingReq").innerText = bookings.filter(b => b.status === "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©").length;
      document.getElementById("acceptedReq").innerText = bookings.filter(b => b.status === "Ù…Ù‚Ø¨ÙˆÙ„").length;

      renderChart(bookings);
      renderTable(bookings);
    }

    window.renderTable = (bookings) => {
      const tbody = document.getElementById("rows");
      tbody.innerHTML = bookings.map(b => `
        <tr>
          <td><b>${b.hallName}</b></td>
          <td>${b.customer}</td>
          <td>${b.date}</td>
          <td><span class="status-pill ${b.status === 'Ù…Ù‚Ø¨ÙˆÙ„' ? 'accepted' : 'pending'}">${b.status}</span></td>
          <td>
            <button class="btn-action btn-acc" onclick="updateStatus('${b.id}', 'Ù…Ù‚Ø¨ÙˆÙ„')">Ù‚Ø¨ÙˆÙ„</button>
            <button class="btn-action btn-ref" onclick="updateStatus('${b.id}', 'Ù…Ø±ÙÙˆØ¶')">Ø±ÙØ¶</button>
          </td>
        </tr>`).join('');
    }

    window.updateStatus = async (id, newStatus) => {
      await updateDoc(doc(db, "bookings", id), { status: newStatus });
      load();
    };

    function renderChart(bookings) {
      const counts = {};
      bookings.forEach(b => counts[b.hallName] = (counts[b.hallName] || 0) + 1);
      new Chart(document.getElementById('usageChart'), {
        type: 'bar',
        data: { labels: Object.keys(counts), datasets: [{ label: 'Ù…Ø±Ø§Øª Ø§Ù„Ø­Ø¬Ø²', data: Object.values(counts), backgroundColor: '#3b82f6', borderRadius: 10 }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });
    }
    load();
</script>
</body>
</html>